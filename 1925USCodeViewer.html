<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1925 US Code Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.6;
            color: #333;
            background-color: #f9f9f9;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #8B4513;
        }

        .header h1 {
            color: #8B4513;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #666;
            font-style: italic;
        }

        .chapter {
            margin-bottom: 40px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            display: none; /* Hidden by default when there's a chapter table */
        }

        .chapter.visible {
            display: block; /* Show when explicitly made visible */
        }

        .chapter.no-table {
            display: block; /* Always show when there's no chapter table */
        }

        .chapter-header {
            background: linear-gradient(135deg, #8B4513, #A0522D);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s ease;
            position: relative;
        }

        .chapter-header:hover {
            background: linear-gradient(135deg, #A0522D, #8B4513);
        }

        .chapter-header h2 {
            font-size: 1.3em;
            margin: 0;
        }

        .chapter-header::after {
            content: '▼';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease;
        }

        .chapter-header.collapsed::after {
            transform: translateY(-50%) rotate(-90deg);
        }

        .chapter-content {
            background: white;
            max-height: none;
            overflow: visible;
            transition: max-height 0.3s ease;
        }

        .chapter-content.collapsed {
            max-height: 0;
            overflow: hidden;
        }

        .section {
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s ease;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section:hover {
            background-color: #fafafa;
        }

        .section-number {
            display: inline-block;
            background: #8B4513;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .section-title {
            font-weight: bold;
            color: #8B4513;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .section-content {
            text-align: justify;
            line-height: 1.7;
            color: #444;
        }

        .citation {
            font-style: italic;
            color: #666;
            font-size: 0.9em;
            margin-top: 8px;
        }

        .title-selector {
            margin-bottom: 20px;
            text-align: center;
        }

        .title-select {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #8B4513;
            border-radius: 5px;
            background: white;
            color: #8B4513;
            cursor: pointer;
            min-width: 200px;
        }

        .title-select:focus {
            outline: none;
            border-color: #A0522D;
        }

        .search-container {
            margin-bottom: 30px;
            text-align: center;
        }

        .search-box {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #8B4513;
            border-radius: 25px;
            width: 300px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-box:focus {
            border-color: #A0522D;
        }

        .highlight {
            background-color: #a5c9d6;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .toggle-all {
            background: #8B4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            transition: background 0.3s ease;
        }

        .toggle-all:hover {
            background: #A0522D;
        }

        .chapter-table {
            background: white;
            border: 2px solid #8B4513;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chapter-table h3 {
            color: #8B4513;
            font-size: 1.2em;
            margin-bottom: 12px;
            text-align: center;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 8px;
        }

        .chapter-table-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 8px;
        }

        .chapter-table-item {
            display: flex;
            align-items: flex-start;
            padding: 8px 10px;
            background: #f9f9f9;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid #8B4513;
        }

        .chapter-table-item:hover {
            background: #f0e6d9;
            transform: translateX(5px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .chapter-table-number {
            font-weight: bold;
            color: #8B4513;
            min-width: 28px;
            font-size: 0.95em;
        }

        .chapter-table-name {
            color: #444;
            line-height: 1.3;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .search-box {
                width: 250px;
            }

            .chapter-table-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>United States Code (1925)</h1>
            <div class="subtitle" id="titleSubtitle">Select a title to view</div>
        </div>

        <div class="title-selector">
            <select class="title-select" id="titleSelect">
                <option value="">Select a Title</option>
                <option value="Title_1.xml">Title 1 — General Provisions</option>
                <option value="Title_2.xml">Title 2 — The Congress</option>
                <option value="Title_3.xml">Title 3 — The President</option>
                <option value="Title_4.xml">Title 4 — Flag and Seal, Seat of Government, and the States</option>
                <option value="Title_5.xml">Title 5 — Executive Departments and Government Officers and Employees</option>
                <option value="Title_6.xml">Title 6 — Official and Penal Bonds</option>
                <option value="Title_7.xml">Title 7 — Agriculture</option>
                <option value="Title_8.xml">Title 8</option>
                <option value="Title_9.xml">Title 9</option>
                <option value="Title_10.xml">Title 10</option>
            </select>
        </div>

        <div class="search-container" id="searchContainer" style="display: none;">
            <input type="text" class="search-box" placeholder="Search sections..." id="searchBox">
            <button class="toggle-all" id="toggleAllBtn" onclick="toggleAllChapters()">Toggle All</button>
        </div>

        <div id="content">
            <!-- Content will be loaded here -->
        </div>
    </div>

    <script>
        let currentXmlData = null;

        // Load and parse XML file
        async function loadXMLFile(filename) {
            try {
                // Try XMLHttpRequest first (better for local files)
                const xmlText = await loadLocalFile(filename);
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                
                // Check for parsing errors
                const parseError = xmlDoc.querySelector("parsererror");
                if (parseError) {
                    throw new Error("Error parsing XML");
                }
                
                return parseXMLToObject(xmlDoc);
            } catch (error) {
                console.error('Error loading XML file:', error);
                
                // Show user-friendly instructions
                const errorMsg = `
Error loading ${filename}. 

This can happen when opening HTML files directly from your computer due to browser security restrictions.

Solutions:
1. RECOMMENDED: Start a simple web server:
   - If you have Python installed, open Command Prompt in this folder and run:
     python -m http.server 8000
   - Then open: http://localhost:8000/Title_1_Viewer.html

2. Try a different browser (some handle local files better)

3. Use the embedded data version (click OK to switch to embedded data)
                `;
                
                if (confirm(errorMsg + "\n\nWould you like to use the embedded data version instead?")) {
                    return getEmbeddedData(filename);
                }
                
                return null;
            }
        }

        // XMLHttpRequest approach for local files
        function loadLocalFile(filename) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open('GET', filename, true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200 || xhr.status === 0) { // 0 for local files
                            resolve(xhr.responseText);
                        } else {
                            reject(new Error(`HTTP ${xhr.status}: ${xhr.statusText}`));
                        }
                    }
                };
                xhr.onerror = function() {
                    reject(new Error('Network error or file not found'));
                };
                xhr.send();
            });
        }

        // Fallback embedded data
        function getEmbeddedData(filename) {
            if (filename === 'Title_1.xml') {
                return {
                    title: "TITLE 1.—GENERAL PROVISIONS",
                    chapters: [
                        {
                            name: "Chapter 1.—RULES OF CONSTRUCTION.",
                            sections: [
                                {
                                    number: "1",
                                    title: "Words importing singular number, masculine gender, etc.; extended application.",
                                    content: "In determining the meaning of any Act or resolution of Congress, words importing the singular number may extend and be applied to several persons or things; words importing the plural number may include the singular; words importing the masculine gender may be applied to females; the words \"insane person\" and \"lunatic\" shall include every idiot, non compos, lunatic, and insane person; the word \"person\" may extend and be applied to partnerships and corporations, and the reference to any officer shall include any person authorized by law to perform the duties of such office, unless the context shows that such words were intended to be used in a more limited sense; and a requirement of an \"oath\" shall be deemed complied with by making affirmation in judicial form.",
                                    citation: "(R.S. § 1.)"
                                },
                                {
                                    number: "2",
                                    title: "\"County\" as including \"parish,\" etc.",
                                    content: "The word \"county\" includes a parish, or any other equivalent subdivision of a State or Territory of the United States.",
                                    citation: "(R.S. § 2.)"
                                },
                                {
                                    number: "3",
                                    title: "\"Vessel\" as including all means of water transportation.",
                                    content: "The word \"vessel\" includes every description of water craft or other artificial contrivance used, or capable of being used, as a means of transportation on water.",
                                    citation: "(R.S. § 3.)"
                                },
                                {
                                    number: "4",
                                    title: "\"Vehicle\" as including all means of land transportation.",
                                    content: "The word \"vehicle\" includes every description of carriage or other artificial contrivance used, or capable of being used, as a means of transportation on land.",
                                    citation: "(R.S. § 4.)"
                                },
                                {
                                    number: "5",
                                    title: "\"Company\" and \"association\" as including successors and assigns.",
                                    content: "The word \"company\" or \"association,\" when used in reference to a corporation, shall be deemed to embrace the words \"successors and assigns of such company or association,\" in like manner as if these last-named words, or words of similar import, were expressed.",
                                    citation: "(R.S. § 5.)"
                                }
                            ]
                        },
                        {
                            name: "Chapter 2.—ACTS AND RESOLUTIONS OF THE CONGRESS; FORMALITIES OF ENACTMENT; REPEALS; SEALING OF INSTRUMENTS.",
                            sections: [
                                {
                                    number: "21",
                                    title: "Enacting clause.",
                                    content: "The enacting clause of all Acts of Congress shall be in the following form: \"Be it enacted by the Senate and House of Representatives of the United States of America in Congress assembled.\"",
                                    citation: "(R.S. § 7.)"
                                },
                                {
                                    number: "22",
                                    title: "Resolving clause.",
                                    content: "The resolving clause of all joint resolutions shall be in the following form: \"Resolved by the Senate and House of Representatives of the United States of America in Congress assembled.\"",
                                    citation: "(R.S. § 8.)"
                                },
                                {
                                    number: "23",
                                    title: "Enacting or resolving words after first section.",
                                    content: "No enacting or resolving words shall be used in any section of an Act or resolution of Congress except in the first.",
                                    citation: "(R.S. § 9.)"
                                },
                                {
                                    number: "24",
                                    title: "Numbering of sections; single proposition.",
                                    content: "Each section shall be numbered, and shall contain, as nearly as may be, a single proposition of enactment.",
                                    citation: "(R.S. § 10.)"
                                },
                                {
                                    number: "25",
                                    title: "Title of appropriation Acts.",
                                    content: "The style and title of all Acts making appropriations for the support of Government shall be as follows: \"An Act making appropriations [here insert the object] for the year ending June 30 [here insert the calendar year].\"",
                                    citation: "(R.S. § 11.)"
                                },
                                {
                                    number: "26",
                                    title: "Printing bills and joint resolutions.",
                                    content: "Every bill or joint resolution in each House of Congress shall, when such bill or resolution passes either House, be printed; and such printed copy shall be called the engrossed bill or resolution, as the case may be. Said engrossed bill or resolution shall be signed by the Clerk of the House or the Secretary of the Senate, and shall be sent to the other House, and in that form shall be dealt with by that House, and its officers; and, if passed, returned signed by said Clerk or Secretary. When such bill or joint resolution shall have passed both Houses, it shall be printed and shall then be called the enrolled bill or joint resolution, as the case may be, and shall be signed by the presiding officers of both Houses and sent to the President of the United States. During the last six days of a session such engrossing and enrolling of bills and joint resolutions may be done otherwise than as above prescribed, upon the order of Congress by concurrent resolution.",
                                    citation: "(Nov. 1, 1893, 28 Stat. Appendix 6; Mar. 2, 1895, c. 177, § 1, 28 Stat. 769.)"
                                },
                                {
                                    number: "27",
                                    title: "Parchment or paper for printing enrolled bills or resolutions.",
                                    content: "Enrolled bills and resolutions of either House of Congress shall be printed on parchment or paper of suitable quality as shall be determined by the Joint Committee on Printing.",
                                    citation: "(Mar. 6, 1920, c. 61, § 1, 41 Stat. 520.)"
                                },
                                {
                                    number: "28",
                                    title: "Effect of repeal of repealing Act.",
                                    content: "Whenever an Act is repealed, which repealed a former Act, such former Act shall not thereby be revived, unless it shall be expressly so provided.",
                                    citation: "(R.S. § 12.)"
                                },
                                {
                                    number: "29",
                                    title: "Repeal of statutes as affecting existing liabilities.",
                                    content: "The repeal of any statute shall not have the effect to release or extinguish any penalty, forfeiture, or liability incurred under such statute, unless the repealing Act shall so expressly provide; and such statute shall be treated as still remaining in force for the purpose of sustaining any proper action or prosecution for the enforcement of such penalty, forfeiture, or liability.",
                                    citation: "(R.S. § 13.)"
                                },
                                {
                                    number: "30",
                                    title: "Pamphlet copies of Acts and Statutes at Large; contents; admissibility in evidence.",
                                    content: "The pamphlet copies of the statutes and the bound copies of the Acts of each Congress shall be legal evidence of the laws and treaties therein contained in all the courts of the United States and of the several States therein. The said pamphlet and the Statutes at Large shall contain all laws, joint and concurrent resolutions passed by Congress, and also all conventions, treaties, proclamations, and agreements.",
                                    citation: "(Jan. 12, 1895, c. 23, § 73, 28 Stat. 615.)"
                                },
                                {
                                    number: "31",
                                    title: "Sealing of instruments.",
                                    content: "In all cases where a seal is necessary by law to any commission, process, or other instrument provided for by the laws of Congress, it shall be lawful to affix the proper seal by making an impression therewith directly on the paper to which such seal is necessary; which shall be as valid as if made on wax or other adhesive substance.",
                                    citation: "(R.S. § 6.)"
                                }
                            ]
                        }
                    ]
                };
            } else if (filename === 'Title_2.xml') {
                return {
                    title: "TITLE 2—THE CONGRESS",
                    chapters: [
                        {
                            name: "Chapter 1.-ELECTION OF SENATORS AND REPRESENTATIVES",
                            sections: [
                                {
                                    number: "1",
                                    title: "Time of commencement of terms of Representatives and Delegates",
                                    content: "The terms of Representatives and Delegates shall begin at noon on the 4th day of March in the year in which they are elected, and shall continue for two years, and until their successors are elected and qualified.",
                                    citation: "(R.S. § 21.)"
                                },
                                {
                                    number: "2",
                                    title: "Number and apportionment of Representatives",
                                    content: "The House of Representatives shall be composed of four hundred and thirty-five Members, to be apportioned among the several States as follows: Alabama, ten. Arizona, one. Arkansas, seven. California, eleven. Colorado, four. Connecticut, five. Delaware, one. Florida, four. Georgia, twelve. Idaho, two. Illinois, twenty-seven. Indiana, thirteen. Iowa, eleven. Kansas, eight. Kentucky, eleven. Louisiana, eight. Maine, four. Maryland, six. Massachusetts, sixteen. Michigan, thirteen. Minnesota, ten. Mississippi, eight. Missouri, sixteen. Montana, two. Nebraska, six. Nevada, one. New Hampshire, two. New Jersey, twelve. New Mexico, one. New York, forty-three. North Carolina, ten. North Dakota, three. Ohio, twenty-two. Oklahoma, eight. Oregon, three. Pennsylvania, thirty-six. Rhode Island, three South Carolina, seven. South Dakota, three. Tennessee, ten. Texas, eighteen. Utah, two. Vermont, two. Virginia, ten. Washington, five. West Virginia, six. Wisconsin, eleven. Wyoming, one.",
                                    citation: "(Aug. 8, 1911, c. 5, §§ 1, 2, 37 Stat. 13, 14; Jan. 6, 1912, 37 Stat. 1723; Feb. 14, 1912, 37 Stat. 1728.)"
                                },
                                {
                                    number: "3",
                                    title: "Election by districts",
                                    content: "In each State entitled under this apportionment to more than one Representative, the Representatives to Congress shall be elected by districts composed of a contiguous and compact territory, and containing as nearly as practicable an equal number of inhabitants. The said districts shall be equal to the number of Representatives to which such State may be entitled in Congress, no district electing more than one Representative.",
                                    citation: "(Aug. 8, 1911, c. 5, § 3, 37 Stat. 14.)"
                                },
                                {
                                    number: "4",
                                    title: "Additional Representatives at large",
                                    content: "In case of an increase in the number of Representatives in any State under this apportionment such additional Representative or Representatives shall be elected by the State at large and the other Representatives by the districts prescribed by law on August 8, 1911, until such State shall be redistricted in the manner provided by the laws thereof and in accordance with the rules enumerated in section 3. If there be no change in the number of Representatives from a State, the Representatives thereof shall be elected from the districts prescribed by law on August 8, 1911, until such State shall be redistricted as herein prescribed.",
                                    citation: "(Aug. 8, 1911, c. 5, § 4, 37 Stat. 14.)"
                                },
                                {
                                    number: "5",
                                    title: "Nominations for Representatives at large",
                                    content: "Candidates for Representative or Representatives to be elected at large in any State shall be nominated in the same manner as candidates for governor, unless otherwise provided by the laws of such State.",
                                    citation: "(Aug. 8, 1911, c. 5, § 5, 37 Stat. 15.)"
                                },
                                {
                                    number: "6",
                                    title: "Reduction of representation",
                                    content: "Should any State deny or abridge the right of any of the male inhabitants thereof, being twenty-one years of age, and citizens of the United States, to vote at any election named in the amendment to the Constitution, article 14, section 2, except for participation in rebellion or other crime, the number of Representatives apportioned to such State shall be reduced in the proportion which the number of such male citizens shall have to the whole number of male citizens twenty-one years of age in such State.",
                                    citation: "(R.S. § 22.)"
                                },
                                {
                                    number: "7",
                                    title: "Time of election",
                                    content: "The Tuesday next after the 1st Monday in November, in every even numbered year, is established as the day for the election, in each of the States and Territories of the United States, of Representatives and Delegates to the Congress commencing on the 4th day of March next thereafter. This section shall not apply to any State that has not yet changed its day of election, and whose constitution must be amended in order to effect a change in the day of the election of State officers in said State.",
                                    citation: "(R.S. § 25; Mar. 3, 1875, c. 130, § 6, 18 Stat. 7)"
                                },
                                {
                                    number: "8",
                                    title: "Vacancies",
                                    content: "The Time for holding elections in any State, District, or Territory for a Representative or Delegate to fill a vacancy, whether such vacancy is caused by a failure to elect at the time prescribed by law, or by the death, resignation, or incapacity of a person elected, may be prescribed by the laws of the several States and Territories respectively.",
                                    citation: "(R.S. § 26.)"
                                },
                                {
                                    number: "9",
                                    title: "Voting for Representatives",
                                    content: "All votes for Representatives in Congress must be by written or printed ballot, or voting machine the use of which has been duly authorized by State law; and all votes received or recorded contrary to this section shall be of no effect.",
                                    citation: "(R.S. § 27; Feb. 14, 1899, c. 151, 30 Stat. 836.)"
                                }
                            ]
                        },
                        {
                            name: "Chapter 2.-ORGANIZATION OF CONGRESS.",
                            sections: [
                                {
                                    number: "21",
                                    title: "Oath of Senators.",
                                    content: "The oath of office shall be administered by the President of the Senate to each Senator who shall be elected, previous to his taking his seat.",
                                    citation: "(R.S. § 28.)"
                                },
                                {
                                    number: "22",
                                    title: "Oath of President of Senate.",
                                    content: "When a President of the Senate has not taken the oath of office, it shall be administered to him by any Member of the Senate.",
                                    citation: "(R.S. § 29.)"
                                }
                                // Note: More sections exist in the XML - this is abbreviated for space
                            ]
                        }
                        // Note: More chapters exist in the XML
                    ]
                };
            } else {
                // Generic fallback for other titles
                return {
                    title: `TITLE ${filename.match(/Title_(\d+)\.xml/)?.[1] || ''}`,
                    chapters: [
                        {
                            name: "No embedded data available",
                            sections: [
                                {
                                    number: "1",
                                    title: "XML Loading Required",
                                    content: `The embedded data for ${filename} is not available. Please use a web server to load the XML file directly, or add the embedded data for this title to the HTML file.`,
                                    citation: ""
                                }
                            ]
                        }
                    ]
                };
            }
            return null;
        }

        // Parse XML document to JavaScript object
        function parseXMLToObject(xmlDoc) {
            const titleElement = xmlDoc.querySelector('Title');
            if (!titleElement) return null;

            const titleName = titleElement.getAttribute('name');
            const chapters = [];

            const chapterElements = titleElement.querySelectorAll('Chapter');
            
            if (chapterElements.length > 0) {
                // Title has chapters - parse normally
                chapterElements.forEach(chapterEl => {
                    const chapterName = chapterEl.getAttribute('name');
                    const sections = [];

                    const sectionElements = chapterEl.querySelectorAll('Section, section');
                    sectionElements.forEach(sectionEl => {
                        const sectionName = sectionEl.getAttribute('name');
                        const sectionContent = sectionEl.textContent.trim();
                        
                        // Extract section number and title from the name attribute
                        const match = sectionName.match(/^(\d+)\.\s*(.+)$/);
                        let number = '';
                        let title = sectionName;
                        
                        if (match) {
                            number = match[1];
                            title = match[2];
                        }
                        
                        // Extract citation (text in parentheses at the end)
                        const citationMatch = sectionContent.match(/\(([^)]+)\)\.?\s*$/);
                        let content = sectionContent;
                        let citation = '';
                        
                        if (citationMatch) {
                            citation = '(' + citationMatch[1] + ')';
                            content = sectionContent.replace(/\s*\([^)]+\)\.?\s*$/, '');
                        }
                        
                        sections.push({
                            number: number,
                            title: title,
                            content: content,
                            citation: citation
                        });
                    });

                    if (sections.length > 0) {
                        chapters.push({
                            name: chapterName,
                            sections: sections
                        });
                    }
                });
            } else {
                // No chapters - sections are directly under Title (like Title 4)
                const sectionElements = titleElement.querySelectorAll('Section, section');
                if (sectionElements.length > 0) {
                    const sections = [];
                    
                    sectionElements.forEach(sectionEl => {
                        const sectionName = sectionEl.getAttribute('name');
                        const sectionContent = sectionEl.textContent.trim();
                        
                        // Extract section number and title from the name attribute
                        const match = sectionName.match(/^(\d+)\.\s*(.+)$/);
                        let number = '';
                        let title = sectionName;
                        
                        if (match) {
                            number = match[1];
                            title = match[2];
                        }
                        
                        // Extract citation (text in parentheses at the end)
                        const citationMatch = sectionContent.match(/\(([^)]+)\)\.?\s*$/);
                        let content = sectionContent;
                        let citation = '';
                        
                        if (citationMatch) {
                            citation = '(' + citationMatch[1] + ')';
                            content = sectionContent.replace(/\s*\([^)]+\)\.?\s*$/, '');
                        }
                        
                        sections.push({
                            number: number,
                            title: title,
                            content: content,
                            citation: citation
                        });
                    });
                    
                    // Create a single "chapter" containing all sections
                    chapters.push({
                        name: "Sections",
                        sections: sections
                    });
                }
            }

            return {
                title: titleName,
                chapters: chapters
            };
        }

        // Render content to HTML
        function renderContent() {
            if (!currentXmlData) {
                document.getElementById('content').innerHTML = '<p style="text-align: center; color: #666; font-style: italic;">Please select a title to view its contents.</p>';
                document.getElementById('toggleAllBtn').style.display = 'none';
                document.getElementById('searchContainer').style.display = 'none';
                return;
            }

            const container = document.getElementById('content');
            container.innerHTML = '';

            const hasMultipleChapters = currentXmlData.chapters.length > 1;
            
            // Show search container when a title is selected
            document.getElementById('searchContainer').style.display = 'block';
            
            // Show/hide toggle button based on whether there are multiple chapters
            const toggleBtn = document.getElementById('toggleAllBtn');
            if (hasMultipleChapters) {
                toggleBtn.style.display = 'inline-block';
            } else {
                toggleBtn.style.display = 'none';
            }

            // Add chapter table if there are multiple chapters
            if (hasMultipleChapters) {
                const chapterTable = document.createElement('div');
                chapterTable.className = 'chapter-table';
                
                const tableTitle = document.createElement('h3');
                tableTitle.textContent = 'Table of Chapters';
                chapterTable.appendChild(tableTitle);
                
                const tableGrid = document.createElement('div');
                tableGrid.className = 'chapter-table-grid';
                
                currentXmlData.chapters.forEach((chapter, chapterIndex) => {
                    // Extract chapter number from chapter name (e.g., "Chapter 1.—GRAIN FUTURES ACT.")
                    const chapterMatch = chapter.name.match(/Chapter\s+(\d+)\.\s*[—–-]\s*(.+)/i);
                    let chapterNum = chapterIndex + 1;
                    let chapterName = chapter.name;
                    
                    if (chapterMatch) {
                        chapterNum = chapterMatch[1];
                        chapterName = chapterMatch[2].replace(/\.\s*$/, ''); // Remove trailing period
                    }
                    
                    const tableItem = document.createElement('div');
                    tableItem.className = 'chapter-table-item';
                    tableItem.onclick = () => showOnlyChapter(chapterIndex);
                    
                    const itemNumber = document.createElement('div');
                    itemNumber.className = 'chapter-table-number';
                    itemNumber.textContent = chapterNum + '.';
                    
                    const itemName = document.createElement('div');
                    itemName.className = 'chapter-table-name';
                    itemName.textContent = chapterName;
                    
                    tableItem.appendChild(itemNumber);
                    tableItem.appendChild(itemName);
                    tableGrid.appendChild(tableItem);
                });
                
                chapterTable.appendChild(tableGrid);
                container.appendChild(chapterTable);
            }

            currentXmlData.chapters.forEach((chapter, chapterIndex) => {
                const chapterDiv = document.createElement('div');
                chapterDiv.className = 'chapter';
                chapterDiv.id = 'chapter-' + chapterIndex;
                
                // If there's no chapter table, show sections directly (no collapsing)
                if (!hasMultipleChapters) {
                    chapterDiv.classList.add('no-table');
                }
                
                const chapterHeader = document.createElement('div');
                chapterHeader.className = hasMultipleChapters ? 'chapter-header collapsed' : 'chapter-header';
                chapterHeader.onclick = () => toggleChapter(chapterIndex);
                
                const chapterTitle = document.createElement('h2');
                chapterTitle.textContent = chapter.name;
                chapterHeader.appendChild(chapterTitle);
                
                const chapterContent = document.createElement('div');
                chapterContent.className = hasMultipleChapters ? 'chapter-content collapsed' : 'chapter-content';
                
                chapter.sections.forEach(section => {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'section';
                    
                    const sectionNumber = document.createElement('div');
                    sectionNumber.className = 'section-number';
                    sectionNumber.textContent = section.number;
                    
                    const sectionTitle = document.createElement('div');
                    sectionTitle.className = 'section-title';
                    sectionTitle.textContent = section.title;
                    
                    const sectionContentDiv = document.createElement('div');
                    sectionContentDiv.className = 'section-content';
                    sectionContentDiv.textContent = section.content;
                    
                    sectionDiv.appendChild(sectionNumber);
                    sectionDiv.appendChild(sectionTitle);
                    sectionDiv.appendChild(sectionContentDiv);
                    
                    if (section.citation) {
                        const citation = document.createElement('div');
                        citation.className = 'citation';
                        citation.textContent = section.citation;
                        sectionDiv.appendChild(citation);
                    }
                    
                    chapterContent.appendChild(sectionDiv);
                });
                
                chapterDiv.appendChild(chapterHeader);
                chapterDiv.appendChild(chapterContent);
                container.appendChild(chapterDiv);
            });
        }

        // Toggle chapter visibility
        function toggleChapter(index) {
            const chapters = document.querySelectorAll('.chapter');
            const chapter = chapters[index];
            const header = chapter.querySelector('.chapter-header');
            const content = chapter.querySelector('.chapter-content');
            
            header.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }

        // Show only the selected chapter and hide all others
        function showOnlyChapter(index) {
            const allChapters = document.querySelectorAll('.chapter');
            const selectedChapter = document.getElementById('chapter-' + index);
            
            if (selectedChapter) {
                // Hide all chapters first
                allChapters.forEach(chapter => {
                    chapter.classList.remove('visible');
                });
                
                // Show only the selected chapter
                selectedChapter.classList.add('visible');
                
                // Scroll to the chapter
                selectedChapter.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Open the chapter content
                const header = selectedChapter.querySelector('.chapter-header');
                const content = selectedChapter.querySelector('.chapter-content');
                
                header.classList.remove('collapsed');
                content.classList.remove('collapsed');
            }
        }

        // Toggle all chapters
        function toggleAllChapters() {
            const headers = document.querySelectorAll('.chapter-header');
            const contents = document.querySelectorAll('.chapter-content');
            const allChapters = document.querySelectorAll('.chapter');
            
            // Check if any chapters are open
            const anyOpen = Array.from(contents).some(content => !content.classList.contains('collapsed'));
            
            // If any are open, close all; otherwise, open all and make all visible
            headers.forEach(header => {
                if (anyOpen) {
                    header.classList.add('collapsed');
                } else {
                    header.classList.remove('collapsed');
                }
            });
            
            contents.forEach(content => {
                if (anyOpen) {
                    content.classList.add('collapsed');
                } else {
                    content.classList.remove('collapsed');
                }
            });
            
            // Make all chapters visible when opening all
            allChapters.forEach(chapter => {
                if (!anyOpen) {
                    chapter.classList.add('visible');
                } else {
                    chapter.classList.remove('visible');
                }
            });
        }

        // Setup search functionality
        function setupSearch() {
            const searchBox = document.getElementById('searchBox');
            searchBox.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const sections = document.querySelectorAll('.section');
                
                sections.forEach(section => {
                    const title = section.querySelector('.section-title').textContent.toLowerCase();
                    const content = section.querySelector('.section-content').textContent.toLowerCase();
                    const number = section.querySelector('.section-number').textContent.toLowerCase();
                    
                    if (title.includes(searchTerm) || content.includes(searchTerm) || number.includes(searchTerm)) {
                        section.style.display = 'block';
                        highlightText(section, searchTerm);
                        
                        // Open and show the chapter containing this section
                        const chapter = section.closest('.chapter');
                        const chapterContent = chapter.querySelector('.chapter-content');
                        const chapterHeader = chapter.querySelector('.chapter-header');
                        chapterContent.classList.remove('collapsed');
                        chapterHeader.classList.remove('collapsed');
                        chapter.classList.add('visible'); // Make chapter visible during search
                    } else {
                        section.style.display = searchTerm ? 'none' : 'block';
                        removeHighlight(section);
                    }
                });
                
                // If search is cleared, hide all chapters again (for titles with chapter tables)
                if (!searchTerm && currentXmlData && currentXmlData.chapters.length > 1) {
                    const allChapters = document.querySelectorAll('.chapter');
                    allChapters.forEach(chapter => {
                        chapter.classList.remove('visible');
                    });
                }
            });
        }

        // Handle title selection
        function handleTitleChange() {
            const titleSelect = document.getElementById('titleSelect');
            const titleSubtitle = document.getElementById('titleSubtitle');
            const selectedFile = titleSelect.value;
            
            if (selectedFile) {
                titleSubtitle.textContent = 'Loading...';
                loadXMLFile(selectedFile).then(data => {
                    if (data) {
                        currentXmlData = data;
                        titleSubtitle.textContent = data.title;
                        renderContent();
                        setupSearch();
                    } else {
                        titleSubtitle.textContent = 'Error loading title';
                        currentXmlData = null;
                        renderContent();
                    }
                });
            } else {
                titleSubtitle.textContent = 'Select a title to view';
                currentXmlData = null;
                renderContent();
            }
        }

        // Highlight search terms
        function highlightText(element, searchTerm) {
            if (!searchTerm) return;
            
            const walker = document.createTreeWalker(
                element,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            const textNodes = [];
            let node;
            while (node = walker.nextNode()) {
                textNodes.push(node);
            }
            
            textNodes.forEach(textNode => {
                const text = textNode.textContent;
                const regex = new RegExp(`(${searchTerm})`, 'gi');
                if (regex.test(text)) {
                    const highlightedText = text.replace(regex, '<span class="highlight">$1</span>');
                    const span = document.createElement('span');
                    span.innerHTML = highlightedText;
                    textNode.parentNode.replaceChild(span, textNode);
                }
            });
        }

        // Remove highlights
        function removeHighlight(element) {
            const highlights = element.querySelectorAll('.highlight');
            highlights.forEach(highlight => {
                const parent = highlight.parentNode;
                parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
                parent.normalize();
            });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            const titleSelect = document.getElementById('titleSelect');
            titleSelect.addEventListener('change', handleTitleChange);
            renderContent();
        });
    </script>
</body>
</html>